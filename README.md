# Лекция: Настройка проверки типов в проекте с tRPC

---

## 1. Введение
### Почему проверка типов важна?
- **Гарантия безопасности**: Предотвращает ошибки на этапе разработки
- **Синхронизация бэкенда и фронтенда**: Особенно критично при использовании tRPC
- **Ускорение разработки**: Автодополнение и мгновенная обратная связь

---

## 2. Настройка проверки типов на бэкенде
### Шаг 1: Создание скрипта
Добавить в `package.json` бэкенда:
```json
"scripts": {
  "ty": "tsc --noEmit -p tsconfig.json"
}
```

### Шаг 2: Запуск проверки
```bash
cd backend
pnpm ty
```

### Пример ошибки:
```ts
let x: number = "строка"; // Ошибка: Тип "string" не может быть присвоен типу "number"
```

---

## 3. Настройка проверки типов на фронтенде
### Особенности конфигурации:
- **Два конфига**:
  1. `tsconfig.json` - для сборки
  2. `tsconfig.node.json` - для работы с Vite

### Скрипты для фронтенда:
```json
"scripts": {
  "ty:build": "tsc --noEmit -p tsconfig.json",
  "ty:dev": "tsc --noEmit -p tsconfig.node.json"
}
```

### Запуск полной проверки:
```bash
pnpm ty:build && pnpm ty:dev
```

---

## 4. Пример реального сценария
### Ситуация:
1. На бэкенде изменяется структура ответа API:
```ts
// Было
interface Idea { id: number; name: string }

// Стало
interface Idea { uid: string; title: string }
```

2. На фронтенде продолжается использование старой структуры:
```tsx
trpc.idea.getAll.useQuery().data?.ideas[0].id // Ошибка: Свойство 'id' не существует
```

### Реакция разработчика:
1. Ошибка мгновенно обнаруживается через `pnpm ty`
2. Автопереход к проблемному месту через IDE (Ctrl+Click)
3. Синхронизация типов через tRPC

---

## 5. Оптимизация конфигурации
### Проблема:
- Файл `tsconfig.tsbuildinfo` создает "шум" в проекте

### Решение:
Добавить в `tsconfig.json`:
```json
{
  "compilerOptions": {
    "tsBuildInfoFile": "node_modules/.cache/tsbuildinfo"
  }
}
```

### Результат:
- Системные файлы скрыты в `node_modules`
- Чистая структура проекта
- Автоматическое игнорирование в `.gitignore`

---

## 6. Преимущества подхода
1. **Сквозная проверка**:
   - Единая команда для проверки всех частей проекта
   - Обнаружение расхождений типов до runtime

2. **Интеграция с tRPC**:
   ```ts
   // Автоматическая синхронизация типов
   const { data } = trpc.idea.getAll.useQuery();
   // data автоматически получает тип с бэкенда
   ```

3. **CI/CD интеграция**:
   ```yaml
   # Пример для GitHub Actions
   - name: Check types
     run: pnpm ty
   ```

---

## 7. Рекомендации
1. **Локализация ошибок**:
   - Используйте `// @ts-expect-error` для преднамеренных исключений
   - Группируйте связанные типы в неймспейсы

2. **Кастомизация**:
   ```json
   // tsconfig.json
   {
     "compilerOptions": {
       "strict": true,
       "noUnusedLocals": true
     }
   }
   ```

3. **Интеграция с ESLint**:
   ```bash
   pnpm add @typescript-eslint/eslint-plugin --dev
   ```

---

## Заключение
- Проверка типов - критически важный этап в Fullstack-разработке
- tRPC упрощает синхронизацию типов между слоями приложения
- Автоматизация проверок экономит часы отладки

> **Совет**: Настраивайте проверку типов при создании проекта - это окупится при первом же рефакторинге!